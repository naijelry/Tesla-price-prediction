# -*- coding: utf-8 -*-
"""rolling_statistics_and_lagfeatures

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1D553aq0vjoDgIv0H3_DzMLnrfKHpA89f
"""

import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

# Load the dataset
df = pd.read_csv('/content/tesla_stock_data_final_cleaneddata(noduplciates_nomissingvalues).csv')

# Convert 'timestamp' to datetime format
df['timestamp'] = pd.to_datetime(df['timestamp'])
df.set_index('timestamp', inplace=True)

# Check for missing values
print(f"Missing values:\n{df.isnull().sum()}")

# Date-based features
df['day_of_week'] = df.index.dayofweek
df['month'] = df.index.month
df['year'] = df.index.year
df['is_weekend'] = (df['day_of_week'] >= 5).astype(int)  # Weekend feature

# Rolling statistics (7-day and 30-day averages)
df['7_day_avg'] = df['close'].rolling(window=7).mean()
df['30_day_avg'] = df['close'].rolling(window=30).mean()

# Volatility (difference between high and low prices over 7-day window)
df['7_day_volatility'] = df['high'].rolling(window=7).max() - df['low'].rolling(window=7).min()

# Lag features (previous day, 5 days ago, 10 days ago)
df['close_lag_1'] = df['close'].shift(1)
df['close_lag_5'] = df['close'].shift(5)
df['close_lag_10'] = df['close'].shift(10)

# Remove rows with NaN values generated by rolling and lag features
df.dropna(inplace=True)